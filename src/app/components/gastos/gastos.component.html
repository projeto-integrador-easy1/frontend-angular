<section class="tela-gastos">
  <div class="estado-vazio" *ngIf="carregando">
    Carregando...
  </div>

  <div *ngIf="!carregando">
    <div class="estado-vazio" *ngIf="movimentos.length === 0">
      Você ainda não possui nenhum gasto cadastrado em nosso sistema.
      <a href="#" (click)="$event.preventDefault(); abrirModal()">Criar aqui</a>
    </div>

    <div class="lista-gastos">
    <div class="linha-gasto" *ngFor="let g of movimentos; let i = index">
      <div class="dados-gasto">
        <div class="titulo-gasto">{{ g.nome }}</div>
        <div class="descricao-gasto">{{ g.descricao }}</div>
      </div>
      <div class="acoes-gasto">
        <div class="valor-gasto" [style.color]="isReceita(g.tipo) ? '#2bb39a' : '#e24b4b'">{{ isReceita(g.tipo) ? '+' : '-' }} R$ {{ g.valor.toFixed(2) }}</div>
        <svg class="icone-editar" (click)="abrirModalEdicao(i)" title="Editar transação" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        <span class="icone-remover" (click)="removerTransacao(i)" title="Excluir transação">X</span>
      </div>
    </div>
  </div>
  </div>

  <button class="botao-adicionar" *ngIf="!carregando" (click)="abrirModal()">+</button>

  <!-- modal de criação de gasto -->
   
  <div class="modal-fundo" *ngIf="mostrarModal" role="dialog" aria-modal="true" aria-label="Criar novo gasto">
    <div class="modal-caixa">
      <header class="modal-cabecalho">
        <h3 class="titulo-modal">{{ transacaoEditando ? 'EDITAR TRANSAÇÃO' : 'NOVA TRANSAÇÃO' }}</h3>
        <button class="fechar-modal" (click)="fecharModal()" aria-label="Fechar modal">&times;</button>
      </header>

      <form class="modal-corpo" [formGroup]="formTransacao" (ngSubmit)="criarTransacao()">
        <label class="label">TIPO</label>
        <select class="campo" formControlName="tipo">
          <option value="gasto">Gasto (saída)</option>
          <option value="entrada">Entrada</option>
        </select>
        <div *ngIf="formTransacao.get('tipo')?.invalid && formTransacao.get('tipo')?.touched">
          <small>Tipo é obrigatório.</small>
        </div>

        <label class="label">NOME</label>
        <input class="campo" placeholder="Ex: Academia" formControlName="nome" />
        <div *ngIf="formTransacao.get('nome')?.invalid && formTransacao.get('nome')?.touched">
          <small>Nome é obrigatório (mínimo 3 caracteres).</small>
        </div>

        <label class="label">DESCRIÇÃO</label>
        <input class="campo" placeholder="Ex: Mensalidade" formControlName="descricao" />

        <label class="label">VALOR</label>
        <div class="campo-completo">
          <span class="prefixo-moeda">R$</span>
          <input class="campo campo-moeda" type="number" step="0.01" min="0" placeholder="0.00" formControlName="valor" />
        </div>
        <div *ngIf="formTransacao.get('valor')?.invalid && formTransacao.get('valor')?.touched">
          <small>Valor é obrigatório (mínimo R$ 0,01).</small>
        </div>

        <label class="label">DATA</label>
        <input class="campo" type="date" formControlName="data" />
        <div *ngIf="formTransacao.get('data')?.invalid && formTransacao.get('data')?.touched">
          <small>Data é obrigatória.</small>
        </div>

        <div class="botoes-modal">
          <button type="submit" class="botao-criar" [disabled]="formTransacao.invalid">{{ transacaoEditando ? 'SALVAR' : 'CRIAR' }}</button>
          <button type="button" class="botao-fechar" (click)="fecharModal()">CANCELAR</button>
        </div>
      </form>
    </div>
  </div>
</section>
